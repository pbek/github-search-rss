{
    "version": "https://jsonfeed.org/version/1",
    "title": "NixOS Package PRs for knotifyconfig, kdepim-runtime, ffmpegthumbs, libressl-3.7.2, cryptsetup-2.6.1, gnupg packages",
    "home_page_url": "https://pbek.github.io/github-search-rss/nixos-packages-12.json",
    "feed_url": "https://pbek.github.io/github-search-rss/nixos-packages-12.json",
    "description": "NixOS Package PRs for knotifyconfig, kdepim-runtime, ffmpegthumbs, libressl-3.7.2, cryptsetup-2.6.1, gnupg packages on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/37933096?u=b11a857efbc669246eb43904472627625dcdbbdb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Automatic update generated by <a href=\"https://github.com/ryantm/nixpkgs-update\">nixpkgs-update</a> tools. This update was made based on information from passthru.updateScript.</p>\n<p dir=\"auto\">meta.description for python310Packages.python-gnupg is: API for the GNU Privacy Guard (GnuPG)</p>\n<p dir=\"auto\">meta.homepage for python310Packages.python-gnupg is: <a href=\"https://github.com/vsajip/python-gnupg\">https://github.com/vsajip/python-gnupg</a></p>\n<h6 dir=\"auto\">Updates performed</h6>\n<ul dir=\"auto\">\n<li>Ran passthru.UpdateScript</li>\n</ul>\n<h6 dir=\"auto\">To inspect upstream changes</h6>\n<h6 dir=\"auto\">Impact</h6>\n<details>\n<summary>\n<b>Checks done</b> (click to expand)\n</summary>\n<hr>\n<ul dir=\"auto\">\n<li>built on NixOS</li>\n<li>The tests defined in <code class=\"notranslate\">passthru.tests</code>, if any, passed</li>\n<li>found 0.5.1 with grep in /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1</li>\n<li>found 0.5.1 in filename of file in /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1</li>\n</ul>\n<hr>\n</details>\n<details>\n<summary>\n<b>Rebuild report</b> (if merged into master) (click to expand)\n</summary>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"23 total rebuild path(s)\n\n23 package rebuild(s)\n\nFirst fifty rebuilds by attrpath\nblocksat-cli\ngajim\nhash-slinger\niceshelf\nnotus-scanner\nospd-openvas\npaperless-ngx\npass2csv\nprivacyidea\nprotonvpn-cli\nprotonvpn-gui\npython310Packages.blocksat-cli\npython310Packages.limnoria\npython310Packages.notus-scanner\npython310Packages.proton-client\npython310Packages.protonvpn-nm-lib\npython310Packages.python-gnupg\npython311Packages.blocksat-cli\npython311Packages.limnoria\npython311Packages.notus-scanner\npython311Packages.proton-client\npython311Packages.protonvpn-nm-lib\npython311Packages.python-gnupg\"><pre class=\"notranslate\"><code class=\"notranslate\">23 total rebuild path(s)\n\n23 package rebuild(s)\n\nFirst fifty rebuilds by attrpath\nblocksat-cli\ngajim\nhash-slinger\niceshelf\nnotus-scanner\nospd-openvas\npaperless-ngx\npass2csv\nprivacyidea\nprotonvpn-cli\nprotonvpn-gui\npython310Packages.blocksat-cli\npython310Packages.limnoria\npython310Packages.notus-scanner\npython310Packages.proton-client\npython310Packages.protonvpn-nm-lib\npython310Packages.python-gnupg\npython311Packages.blocksat-cli\npython311Packages.limnoria\npython311Packages.notus-scanner\npython311Packages.proton-client\npython311Packages.protonvpn-nm-lib\npython311Packages.python-gnupg\n</code></pre></div>\n</details>\n<details>\n<summary>\n<b>Instructions to test this update</b> (click to expand)\n</summary>\n<hr>\n<p dir=\"auto\">Either <strong>download from Cachix</strong>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"nix-store -r /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1 \\\n  --option binary-caches 'https://cache.nixos.org/ https://nix-community.cachix.org/' \\\n  --option trusted-public-keys '\n  nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=\n  cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=\n  '\"><pre class=\"notranslate\"><code class=\"notranslate\">nix-store -r /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1 \\\n  --option binary-caches 'https://cache.nixos.org/ https://nix-community.cachix.org/' \\\n  --option trusted-public-keys '\n  nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=\n  cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=\n  '\n</code></pre></div>\n<p dir=\"auto\">(The Cachix cache is only trusted for this store-path realization.)<br>\nFor the Cachix download to work, your user must be in the <code class=\"notranslate\">trusted-users</code> list or you can use <code class=\"notranslate\">sudo</code> since root is effectively trusted.</p>\n<p dir=\"auto\">Or, <strong>build yourself</strong>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"nix-build -A python310Packages.python-gnupg https://github.com/r-ryantm/nixpkgs/archive/95ef9c42d145ccb36136072378b5b74f516d557c.tar.gz\"><pre class=\"notranslate\"><code class=\"notranslate\">nix-build -A python310Packages.python-gnupg https://github.com/r-ryantm/nixpkgs/archive/95ef9c42d145ccb36136072378b5b74f516d557c.tar.gz\n</code></pre></div>\n<p dir=\"auto\">After you've downloaded or built it, look at the files and if there are any, run the binaries:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ls -la /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1\nls -la /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1/bin\"><pre class=\"notranslate\"><code class=\"notranslate\">ls -la /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1\nls -la /nix/store/pqd180cyz4jplwwf6g4izxmx6y516pd9-python3.10-python-gnupg-0.5.1/bin\n</code></pre></div>\n<hr>\n</details>\n<br>\n<h3 dir=\"auto\">Pre-merge build results</h3>\n<p dir=\"auto\">We have automatically built all packages that will get rebuilt due to<br>\nthis change.</p>\n<p dir=\"auto\">This gives evidence on whether the upgrade will break dependent packages.<br>\nNote sometimes packages show up as <em>failed to build</em> independent of the<br>\nchange, simply because they are already broken on the target branch.</p>\n<p dir=\"auto\">Result of <code class=\"notranslate\">nixpkgs-review</code> run on x86_64-linux <a href=\"https://github.com/Mic92/nixpkgs-review\">1</a></p>\n<details>\n  <summary>21 packages built:</summary>\n  <ul dir=\"auto\">\n    <li>blocksat-cli (python310Packages.blocksat-cli)</li>\n    <li>gajim</li>\n    <li>hash-slinger</li>\n    <li>iceshelf</li>\n    <li>notus-scanner (python310Packages.notus-scanner)</li>\n    <li>ospd-openvas</li>\n    <li>paperless-ngx</li>\n    <li>pass2csv</li>\n    <li>privacyidea</li>\n    <li>protonvpn-cli</li>\n    <li>protonvpn-gui</li>\n    <li>python310Packages.limnoria</li>\n    <li>python310Packages.proton-client</li>\n    <li>python310Packages.protonvpn-nm-lib</li>\n    <li>python310Packages.python-gnupg</li>\n    <li>python311Packages.blocksat-cli</li>\n    <li>python311Packages.limnoria</li>\n    <li>python311Packages.notus-scanner</li>\n    <li>python311Packages.proton-client</li>\n    <li>python311Packages.protonvpn-nm-lib</li>\n    <li>python311Packages.python-gnupg</li>\n  </ul>\n</details>\n<hr>\n<h6 dir=\"auto\">Maintainer pings</h6>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/copumpkin/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/copumpkin\">@copumpkin</a> for <a href=\"https://github.com/ryantm/nixpkgs-update/blob/master/doc/nixpkgs-maintainer-faq.md#r-ryantm-opened-a-pr-for-my-package-what-do-i-do\">testing</a>.</p>",
            "url": "https://github.com/NixOS/nixpkgs/pull/245069",
            "title": "python310Packages.python-gnupg: 0.5.0 -> 0.5.1",
            "date_modified": "2023-07-23T18:41:39.000Z",
            "date_published": "2023-07-23T18:16:44.000Z",
            "author": {
                "name": "r-ryantm",
                "url": "https://github.com/r-ryantm"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/21160136?u=29cb21ce31e7854776bad84708c21e7de2d39a8e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h6 dir=\"auto\">Motivation for this change</h6>\n<p dir=\"auto\">This <code class=\"notranslate\">security.gnupg</code> proposal aims at granularly sending, decrypting, and installing secrets (and if need be reloading services depending on them) coming from GnuPG encrypted files put into the Nix store, by leveraging <code class=\"notranslate\">password-store</code>, <code class=\"notranslate\">gpg-agent</code>, <code class=\"notranslate\">systemd</code> and <code class=\"notranslate\">nix copy</code>.</p>\n<p dir=\"auto\">Thanks in advance for your feedbacks.</p>\n<h6 dir=\"auto\">Features</h6>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Read from a local <code class=\"notranslate\">password-store</code>'s <code class=\"notranslate\">$PASSWORD_STORE_DIR</code> or any <code class=\"notranslate\">.gpg</code> loadable into the Nix store by any mean available.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Check at build-time that needed secrets exist (in <code class=\"notranslate\">config.security.pass.secrets</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> No need to be able to decrypt the secrets at build-time nor locally.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Send only secrets actually used (not the whole <code class=\"notranslate\">password-store</code>), and do not resend them unless they've changed.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Load only in RAM the passphrase to use the decrypting OpenPGP key(s) (with <code class=\"notranslate\">gpg-preset-passphrase</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Remove volatile secrets when unconfigured (leveraging <code class=\"notranslate\">RuntimeDirectory</code>), or persistent secrets only if their <code class=\"notranslate\">postStop</code> is configured to do so.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Restart or reload only needed services (one file in the Nix store and one <code class=\"notranslate\">secret-${secret}.service</code> per entry in <code class=\"notranslate\">config.security.gnupg.secrets</code> allow fine grained <code class=\"notranslate\">postStart</code>, <code class=\"notranslate\">after</code>, <code class=\"notranslate\">wants</code>, or <code class=\"notranslate\">requires</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Allow decorating secrets with non-secret bits (using the option <code class=\"notranslate\">pipe</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Simpler setup than using <code class=\"notranslate\">extraBuiltins.exec</code> calling <code class=\"notranslate\">pass</code> and/or <code class=\"notranslate\">nixops send-keys</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> AFAIU, trusting or signing the activated NixOS generation removes the need to verify secrets.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Use a dedicated <code class=\"notranslate\">gnupg</code> user instead of <code class=\"notranslate\">root</code> to run <code class=\"notranslate\">gpg-agent</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Provide a helper (<code class=\"notranslate\">config.security.gnupg.agent.sendKeys</code>) to send through <code class=\"notranslate\">ssh</code> a decrypting key and its password to <code class=\"notranslate\">gpg-agent</code>.</li>\n</ul>\n<h6 dir=\"auto\">TODO</h6>\n<ol class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Get more real-life tests and feedbacks.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Put the present documentation in the manual.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Write a unit test in <code class=\"notranslate\">nixos/tests/</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Test using smartcard on the target machine.</li>\n</ol>\n<h6 dir=\"auto\">Inconvenients</h6>\n<ol dir=\"auto\">\n<li>An OpenPGP key (preferably dedicated for the task and maybe per target machine) must be generated (with the encryption capability).</li>\n<li>Encrypted secrets are readable by all users in the Nix store, if this is a concern this can maybe be restricted by leveraging <code class=\"notranslate\">apparmor</code> (for which I happen to be proposing the PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"660567981\" data-permission-text=\"Title is private\" data-url=\"https://github.com/NixOS/nixpkgs/issues/93457\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/NixOS/nixpkgs/pull/93457/hovercard\" href=\"https://github.com/NixOS/nixpkgs/pull/93457\">#93457</a> ).</li>\n</ol>\n<h6 dir=\"auto\">Example</h6>\n<p dir=\"auto\">First just rebuild your configuration without configuring secrets, just to enable <code class=\"notranslate\">gpg-agent.service</code>, using:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"security.gnupg.agent.enable = true;\"><pre class=\"notranslate\"><code class=\"notranslate\">security.gnupg.agent.enable = true;\n</code></pre></div>\n<p dir=\"auto\">Then make sure secrets are (re)encrypted to the right OpenPGP recipients (eg. <code class=\"notranslate\">root@example.org</code>'s key):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pass init -p machines/example @admin1@ @admin2@ @root@example.org\"><pre class=\"notranslate\"><code class=\"notranslate\">pass init -p machines/example @admin1@ @admin2@ @root@example.org\n</code></pre></div>\n<p dir=\"auto\">Now configure and use some secret (eg. <code class=\"notranslate\">pass hosts/foo/transmission/settings.json</code>) :</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{ config, lib, pkgs, ... }:\nlet inherit (config.security.gnupg) secrets; in\n{\n# Although it is a path, it is used by `security.gnupg`\n# so that only needed `.gpg` files within it will go into the Nix store\n# (unless it is set to a path beginning by an entry of the `flake.nix`'s `inputs`,\n# in which case it is already inside the Nix store).\nsecurity.gnupg.store = .password-store/hosts/example;\n\n# root:root ownership with 400 mode by default\nsecurity.gnupg.secrets.&quot;transmission/settings.json&quot; = {};\n\n# Enable gpg-agent.service and the security.gnupg.agent.sendKeys script\n# to send the encrypt subkey specified by its keygrip\n# (obtained with: gpg --list-secret-keys --with-keygrip --with-keygrip)\nsecurity.gnupg.agent = {\n  # Activate `gpg-agent` on the target host.\n  # Unless you choose to [forward the agent](https://wiki.gnupg.org/AgentForwarding)\n  # of the orchestrating host, to `/var/lib/gnupg/.gnupg/S.gpg-agent`.\n  enable = true;\n  keyring.&quot;9AA84E6F6D71F9163C46BF396B141A0806219077&quot; = {\n    # Defaults to config.security.gnupg.store + &quot;/keygrip/9AA84E6F6D71F9163C46BF396B141A0806219077.gpg&quot;\n    passwordGpg = .password-store/hosts/example/root.pass.gpg;\n  };\n};\n\n# It's not needed here because `credentialsFile` is set up by the `root` user\n# but for some services their user would have to be added to the `keys` group.\n#users.users.transmission.extraGroups = [ config.users.groups.keys.name ];\n\nsystemd.services.transmission = {\n  after = [ secrets.&quot;transmission/settings.json&quot;.service ];\n  # No reload for transmission: always restart if the secret has changed.\n  # Use `wants` and `security.gnupg.secrets.&quot;path/to/secret&quot;.systemdConfig.postStart`\n  # for a service that can be reloaded.\n  requires = [ secrets.&quot;transmission/settings.json&quot;.service ];\n};\n\nservices.transmission = {\n  enable = true;\n  credentialsFile = secrets.&quot;transmission/settings.json&quot;.path;\n};\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{ config, lib, pkgs, ... }:\nlet inherit (config.security.gnupg) secrets; in\n{\n# Although it is a path, it is used by `security.gnupg`\n# so that only needed `.gpg` files within it will go into the Nix store\n# (unless it is set to a path beginning by an entry of the `flake.nix`'s `inputs`,\n# in which case it is already inside the Nix store).\nsecurity.gnupg.store = .password-store/hosts/example;\n\n# root:root ownership with 400 mode by default\nsecurity.gnupg.secrets.\"transmission/settings.json\" = {};\n\n# Enable gpg-agent.service and the security.gnupg.agent.sendKeys script\n# to send the encrypt subkey specified by its keygrip\n# (obtained with: gpg --list-secret-keys --with-keygrip --with-keygrip)\nsecurity.gnupg.agent = {\n  # Activate `gpg-agent` on the target host.\n  # Unless you choose to [forward the agent](https://wiki.gnupg.org/AgentForwarding)\n  # of the orchestrating host, to `/var/lib/gnupg/.gnupg/S.gpg-agent`.\n  enable = true;\n  keyring.\"9AA84E6F6D71F9163C46BF396B141A0806219077\" = {\n    # Defaults to config.security.gnupg.store + \"/keygrip/9AA84E6F6D71F9163C46BF396B141A0806219077.gpg\"\n    passwordGpg = .password-store/hosts/example/root.pass.gpg;\n  };\n};\n\n# It's not needed here because `credentialsFile` is set up by the `root` user\n# but for some services their user would have to be added to the `keys` group.\n#users.users.transmission.extraGroups = [ config.users.groups.keys.name ];\n\nsystemd.services.transmission = {\n  after = [ secrets.\"transmission/settings.json\".service ];\n  # No reload for transmission: always restart if the secret has changed.\n  # Use `wants` and `security.gnupg.secrets.\"path/to/secret\".systemdConfig.postStart`\n  # for a service that can be reloaded.\n  requires = [ secrets.\"transmission/settings.json\".service ];\n};\n\nservices.transmission = {\n  enable = true;\n  credentialsFile = secrets.\"transmission/settings.json\".path;\n};\n}\n</code></pre></div>\n<h6 dir=\"auto\">Without a <code class=\"notranslate\">flake.nix</code></h6>\n<p dir=\"auto\">From there you can use <code class=\"notranslate\">&lt;nixpkgs/nixos&gt;</code> as usual, interleaving a call to <code class=\"notranslate\">sendKeys</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"nix-build ./nixos.nix -A system -o nixos\nnix copy --to ssh://root@example.org --substitute-on-destination ./nixos\nnix-build ./nixos.nix -A security.gnupg.agent.sendKeys -o sendKeys &amp;&amp; ./sendKeys/bin/gnupg-agent-sendKeys\nssh root@example.org &quot;\n nix-env --profile /nix/var/nix/profiles/system --set $(readlink -m ./nixos) &amp;&amp;\n /nix/var/nix/profiles/system/bin/switch-to-configuration switch&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">nix-build ./nixos.nix -A system -o nixos\nnix copy --to ssh://root@example.org --substitute-on-destination ./nixos\nnix-build ./nixos.nix -A security.gnupg.agent.sendKeys -o sendKeys &amp;&amp; ./sendKeys/bin/gnupg-agent-sendKeys\nssh root@example.org \"\n nix-env --profile /nix/var/nix/profiles/system --set $(readlink -m ./nixos) &amp;&amp;\n /nix/var/nix/profiles/system/bin/switch-to-configuration switch\"\n</code></pre></div>\n<p dir=\"auto\">Logged in as <code class=\"notranslate\">root@example.org</code>, you can then list the systemd units responsible to install those secrets with:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"systemctl list-units 'secret-*' --all\"><pre class=\"notranslate\"><code class=\"notranslate\">systemctl list-units 'secret-*' --all\n</code></pre></div>\n<p dir=\"auto\">and check the ones decrypted on the default destination, like so:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ls -l /run/keys/gnupg/**/file\"><pre class=\"notranslate\"><code class=\"notranslate\">ls -l /run/keys/gnupg/**/file\n</code></pre></div>\n<h6 dir=\"auto\">With a <code class=\"notranslate\">flake.nix</code></h6>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\ninputs.nixpkgs.url = &quot;flake:nixpkgs&quot;;\ninputs.flake-utils.url = &quot;github:numtide/flake-utils&quot;;\ninputs.pass = { type = &quot;path&quot;; path = &quot;./pass&quot;; flake = false; };\noutputs = inputs:\n  {\n    # Usage: nix -L build .#nixosConfigurations.$hostName.config.system.build.toplevel\n    nixosConfigurations = builtins.mapAttrs (hostName: hostConfig:\n      let cfg = import hostConfig { inherit inputs; }; in\n      import (inputs.nixpkgs + &quot;/nixos/lib/eval-config.nix&quot;) (cfg // {\n        extraArgs = {\n          inherit hostName inputs;\n          hosts = inputs.self.nixosConfigurations;\n        } // (cfg.extraArgs or {});\n        modules = cfg.modules ++ [({pkgs, ...}: {\n          nix.extraOptions = &quot;experimental-features = nix-command flakes&quot;;\n          security.gnupg.store = inputs.pass + &quot;/hosts/${hostName}&quot;;\n        })];\n      }))\n      {\n        losurdo = hosts/losurdo.nix;\n        mermet  = hosts/mermet.nix;\n      };\n  }\n  // inputs.flake-utils.lib.eachDefaultSystem (system:\n    let pkgs = inputs.nixpkgs.legacyPackages.${system}; in\n    {\n    apps = builtins.mapAttrs (hostName: { config, ... }: let\n      system = config.system.build.toplevel;\n      target = &quot;root@${config.networking.hostName}.${config.networking.domain}&quot;;\n      profile = &quot;/nix/var/nix/profiles/system&quot;;\n      in rec {\n\n      # Usage: nix run .#$hostName.switch\n      &quot;switch&quot; = {\n        type = &quot;app&quot;;\n        program = (pkgs.writeShellScript &quot;switch&quot; ''\n          set -eux\n          nix-store --add-root hosts/${hostName}.root --indirect --realise ${system}\n          nix copy --to ssh://'${target}' --substitute-on-destination ${system}\n\n          ${sendkeys.program}\n\n          ssh '${target}' \\\n            nix-env --profile '${profile}' --set '${system}' '&amp;&amp;' \\\n            '${profile}'/bin/switch-to-configuration switch\n        '').outPath;\n      };\n\n      # Usage: nix run .#$hostName.sendkeys\n      &quot;sendkeys&quot; = {\n        type = &quot;app&quot;;\n        program = config.security.gnupg.agent.sendKeys + &quot;/bin/gnupg-agent-sendKeys&quot;;\n      };\n    }) inputs.self.nixosConfigurations;}\n  );\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\ninputs.nixpkgs.url = \"flake:nixpkgs\";\ninputs.flake-utils.url = \"github:numtide/flake-utils\";\ninputs.pass = { type = \"path\"; path = \"./pass\"; flake = false; };\noutputs = inputs:\n  {\n    # Usage: nix -L build .#nixosConfigurations.$hostName.config.system.build.toplevel\n    nixosConfigurations = builtins.mapAttrs (hostName: hostConfig:\n      let cfg = import hostConfig { inherit inputs; }; in\n      import (inputs.nixpkgs + \"/nixos/lib/eval-config.nix\") (cfg // {\n        extraArgs = {\n          inherit hostName inputs;\n          hosts = inputs.self.nixosConfigurations;\n        } // (cfg.extraArgs or {});\n        modules = cfg.modules ++ [({pkgs, ...}: {\n          nix.extraOptions = \"experimental-features = nix-command flakes\";\n          security.gnupg.store = inputs.pass + \"/hosts/${hostName}\";\n        })];\n      }))\n      {\n        losurdo = hosts/losurdo.nix;\n        mermet  = hosts/mermet.nix;\n      };\n  }\n  // inputs.flake-utils.lib.eachDefaultSystem (system:\n    let pkgs = inputs.nixpkgs.legacyPackages.${system}; in\n    {\n    apps = builtins.mapAttrs (hostName: { config, ... }: let\n      system = config.system.build.toplevel;\n      target = \"root@${config.networking.hostName}.${config.networking.domain}\";\n      profile = \"/nix/var/nix/profiles/system\";\n      in rec {\n\n      # Usage: nix run .#$hostName.switch\n      \"switch\" = {\n        type = \"app\";\n        program = (pkgs.writeShellScript \"switch\" ''\n          set -eux\n          nix-store --add-root hosts/${hostName}.root --indirect --realise ${system}\n          nix copy --to ssh://'${target}' --substitute-on-destination ${system}\n\n          ${sendkeys.program}\n\n          ssh '${target}' \\\n            nix-env --profile '${profile}' --set '${system}' '&amp;&amp;' \\\n            '${profile}'/bin/switch-to-configuration switch\n        '').outPath;\n      };\n\n      # Usage: nix run .#$hostName.sendkeys\n      \"sendkeys\" = {\n        type = \"app\";\n        program = config.security.gnupg.agent.sendKeys + \"/bin/gnupg-agent-sendKeys\";\n      };\n    }) inputs.self.nixosConfigurations;}\n  );\n}\n</code></pre></div>\n<h6 dir=\"auto\">Things done</h6>\n\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested using sandboxing (<a href=\"https://nixos.org/nixos/manual/options.html#opt-nix.useSandbox\" rel=\"nofollow\">nix.useSandbox</a> on NixOS, or option <code class=\"notranslate\">sandbox</code> in <a href=\"https://nixos.org/nix/manual/#sec-conf-file\" rel=\"nofollow\"><code class=\"notranslate\">nix.conf</code></a> on non-NixOS linux)</li>\n<li>Built on platform(s)\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> NixOS</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> macOS</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> other Linux distributions</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested via one or more NixOS test(s) if existing and applicable for the change (look inside <a href=\"https://github.com/NixOS/nixpkgs/blob/master/nixos/tests\">nixos/tests</a>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested compilation of all pkgs that depend on this change using <code class=\"notranslate\">nix-shell -p nixpkgs-review --run \"nixpkgs-review wip\"</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested execution of all binary files (usually in <code class=\"notranslate\">./result/bin/</code>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Determined the impact on package closure size (by running <code class=\"notranslate\">nix path-info -S</code> before and after)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Ensured that relevant documentation is up to date</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Fits <a href=\"https://github.com/NixOS/nixpkgs/blob/master/.github/CONTRIBUTING.md\">CONTRIBUTING.md</a>.</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\"><pre class=\"notranslate\"><code class=\"notranslate\">\n</code></pre></div>",
            "url": "https://github.com/NixOS/nixpkgs/pull/93659",
            "title": "nixos/security.gnupg: provisioning GnuPG-protected secrets through the Nix store",
            "date_modified": "2023-04-19T14:09:47.000Z",
            "date_published": "2020-07-22T16:38:42.000Z",
            "author": {
                "name": "ju1m",
                "url": "https://github.com/ju1m"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13338791?u=9e9402ed6d02a9be644f2891a9ca9928709b6b50&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h6 dir=\"auto\">Motivation for this change</h6>\n<p dir=\"auto\">GnuPG stubbornly refuses to share access to smartcards, which, among other things, makes it not work properly with Yubikey-manager.</p>\n<p dir=\"auto\">This adds a patch maintained by <a href=\"https://github.com/GPGTools/MacGPG2\">MacOS GPGTools</a> which adds an option to enable shared smartcard access.</p>\n<p dir=\"auto\">There is no change in default behavior, and patch applies cleanly without modifications, so I see no reason why Nix should not have it as well.</p>\n<h6 dir=\"auto\">Things done</h6>\n\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested using sandboxing (<a href=\"https://nixos.org/nixos/manual/options.html#opt-nix.useSandbox\" rel=\"nofollow\">nix.useSandbox</a> on NixOS, or option <code class=\"notranslate\">sandbox</code> in <a href=\"https://nixos.org/nix/manual/#sec-conf-file\" rel=\"nofollow\"><code class=\"notranslate\">nix.conf</code></a> on non-NixOS linux)</li>\n<li>Built on platform(s)\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> NixOS</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> macOS</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> other Linux distributions</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested via one or more NixOS test(s) if existing and applicable for the change (look inside <a href=\"https://github.com/NixOS/nixpkgs/blob/master/nixos/tests\">nixos/tests</a>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested compilation of all pkgs that depend on this change using <code class=\"notranslate\">nix-shell -p nixpkgs-review --run \"nixpkgs-review wip\"</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tested execution of all binary files (usually in <code class=\"notranslate\">./result/bin/</code>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Determined the impact on package closure size (by running <code class=\"notranslate\">nix path-info -S</code> before and after)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Ensured that relevant documentation is up to date</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Fits <a href=\"https://github.com/NixOS/nixpkgs/blob/master/.github/CONTRIBUTING.md\">CONTRIBUTING.md</a>.</li>\n</ul>",
            "url": "https://github.com/NixOS/nixpkgs/pull/97951",
            "title": "GnuPG: add scdaemon shared access patch",
            "date_modified": "2021-09-14T06:59:31.000Z",
            "date_published": "2020-09-14T05:18:08.000Z",
            "author": {
                "name": "uosis",
                "url": "https://github.com/uosis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/689294?u=cad768566e837f02a45bea90821d1ee675069e08&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h4 dir=\"auto\">Motivation for this change</h4>\n<p dir=\"auto\">I personally don't think this should be enabled by default, but on other platforms like darwin ldap support isn't really relevant.</p>\n<h6 dir=\"auto\">Things done</h6>\n\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tested using sandboxing (<a href=\"http://nixos.org/nixos/manual/options.html#opt-nix.useSandbox\" rel=\"nofollow\">nix.useSandbox</a> on NixOS, or option <code class=\"notranslate\">sandbox</code> in <a href=\"http://nixos.org/nix/manual/#sec-conf-file\" rel=\"nofollow\"><code class=\"notranslate\">nix.conf</code></a> on non-NixOS linux)</li>\n<li>Built on platform(s)\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> NixOS</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> macOS</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> other Linux distributions</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested via one or more NixOS test(s) if existing and applicable for the change (look inside <a href=\"https://github.com/NixOS/nixpkgs/blob/master/nixos/tests\">nixos/tests</a>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested compilation of all pkgs that depend on this change using <code class=\"notranslate\">nix-shell -p nixpkgs-review --run \"nixpkgs-review wip\"</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tested execution of all binary files (usually in <code class=\"notranslate\">./result/bin/</code>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Determined the impact on package closure size (by running <code class=\"notranslate\">nix path-info -S</code> before and after)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Ensured that relevant documentation is up to date</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Fits <a href=\"https://github.com/NixOS/nixpkgs/blob/master/.github/CONTRIBUTING.md\">CONTRIBUTING.md</a>.</li>\n</ul>",
            "url": "https://github.com/NixOS/nixpkgs/pull/86616",
            "title": "gnupg: disable ldap support on darwin",
            "date_modified": "2021-06-04T21:06:01.000Z",
            "date_published": "2020-05-02T22:11:06.000Z",
            "author": {
                "name": "LnL7",
                "url": "https://github.com/LnL7"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1983821?u=3bc59d463ca70ec2a9faaa79fb04860643c4d03c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">If pcscd is enabled, we disable the integrated support for CCID<br>\ncompliant reades in scdaemon started by gpg-agent. So it<br>\nfalls back to using pcscd.</p>\n<p dir=\"auto\">Otherwise scdaemon and pcscd will race and only one of those<br>\nprograms gets access to the smartcard.</p>\n<h6 dir=\"auto\">Things done</h6>\n<ul class=\"contains-task-list\">\n<li>Built on platform(s)\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> x86_64-linux</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> aarch64-linux</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> x86_64-darwin</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> aarch64-darwin</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> For non-Linux: Is <code class=\"notranslate\">sandbox = true</code> set in <code class=\"notranslate\">nix.conf</code>? (See <a href=\"https://nixos.org/manual/nix/stable/command-ref/conf-file.html\" rel=\"nofollow\">Nix manual</a>)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tested, as applicable:\n<ul dir=\"auto\">\n<li><a href=\"https://nixos.org/manual/nixos/unstable/index.html#sec-nixos-tests\" rel=\"nofollow\">NixOS test(s)</a> (look inside <a href=\"https://github.com/NixOS/nixpkgs/blob/master/nixos/tests\">nixos/tests</a>)</li>\n<li>and/or <a href=\"https://nixos.org/manual/nixpkgs/unstable/#sec-package-tests\" rel=\"nofollow\">package tests</a></li>\n<li>or, for functions and \"core\" functionality, tests in <a href=\"https://github.com/NixOS/nixpkgs/blob/master/lib/tests\">lib/tests</a> or <a href=\"https://github.com/NixOS/nixpkgs/blob/master/pkgs/test\">pkgs/test</a></li>\n<li>made sure NixOS tests are <a href=\"https://nixos.org/manual/nixpkgs/unstable/#ssec-nixos-tests-linking\" rel=\"nofollow\">linked</a> to the relevant packages</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tested compilation of all packages that depend on this change using <code class=\"notranslate\">nix-shell -p nixpkgs-review --run \"nixpkgs-review rev HEAD\"</code>. Note: all changes have to be committed, also see <a href=\"https://github.com/Mic92/nixpkgs-review#usage\">nixpkgs-review usage</a></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tested basic functionality of all binary files (usually in <code class=\"notranslate\">./result/bin/</code>)</li>\n<li><a href=\"https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md#generating-2211-release-notes\">22.11 Release Notes (or backporting 22.05 Release notes)</a>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> (Package updates) Added a release notes entry if the change is major or breaking</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> (Module updates) Added a release notes entry if the change is significant</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> (Module addition) Added a release notes entry if adding a new NixOS module</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> (Release notes changes) Ran <code class=\"notranslate\">nixos/doc/manual/md-to-db.sh</code> to update generated release notes</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Fits <a href=\"https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md\">CONTRIBUTING.md</a>.</li>\n</ul>",
            "url": "https://github.com/NixOS/nixpkgs/pull/184493",
            "title": "nixos/programs/gnupg: Use `--disable-ccid` if pcscd is enabled.",
            "date_modified": "2022-08-24T07:24:47.000Z",
            "date_published": "2022-08-01T07:54:13.000Z",
            "author": {
                "name": "typetetris",
                "url": "https://github.com/typetetris"
            }
        }
    ]
}